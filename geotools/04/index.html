<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SVG Compass with Extended Map Pan & Zoom</title>
  <style>
    :root {
      --size: 420px;           /* overall SVG size */
      --cx: 210;               /* compass center X */
      --cy: 210;               /* compass center Y */
      --radius: 170;           /* compass outer radius */
      --ring-stroke: 3;        /* ring stroke width */
      --accent: #2563eb;
    }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 24px; background: #f6f6f9; color: #222; }
    h1 { font-size: 1.1rem; margin: 0 0 12px; }
    .wrap { max-width: 820px; margin: 0 auto; }
    .card { background: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 16px; box-shadow: 0 5px 18px rgba(0,0,0,0.06); }
    .controls { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; margin: 12px 0 6px; }
    .controls label { font-weight: 600; }
    .value { font-variant-numeric: tabular-nums; }

    /* Full-width sliders with larger thumbs */
    input[type="range"] { width: 100%; appearance: none; height: 6px; border-radius: 999px; background: #e5e7eb; outline: none; }
    input[type="range"]::-webkit-slider-thumb { appearance: none; width: 22px; height: 22px; border-radius: 50%; background: var(--accent); cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.25); }
    input[type="range"]::-moz-range-thumb { width: 22px; height: 22px; border-radius: 50%; background: var(--accent); cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.25); }

    svg { width: var(--size); height: var(--size); display: block; margin: 14px auto; }
    .ring { fill: none; stroke: #111; stroke-width: var(--ring-stroke); }
    .tick { stroke: #222; stroke-width: 2; }
    .label { font-size: 12px; font-weight: 600; fill: #111; text-anchor: middle; dominant-baseline: middle; }
    .shade1 { fill: hsla(30, 90%, 50%, 0.28); }
    .shade2 { fill: hsla(210, 90%, 50%, 0.24); }
    .arrow-line { stroke: #e63946; stroke-width: 4; stroke-linecap: round; }
    .arrow-head { fill: #e63946; }
    .bg { fill: #eef3f8; }
    .note { font-size: 12px; color: #444; margin-top: 10px; }
    .section-title { margin-top: 16px; font-weight: 700; }
    .grid { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }

    .kicker { font-size: 12px; color: #555; margin-top: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Minimal SVG Compass</h1>
      <div class="controls">
        <label for="heading">Arrow heading (° CW from North)</label>
        <div class="value"><span id="headingValue">0</span>°</div>
      </div>
      <input id="heading" type="range" min="0" max="359" step="1" value="0" />

      <div class="section-title">Map pan &amp; zoom</div>
      <div class="grid">
        <label for="mapX">Map offset X (px)</label><div class="value"><span id="mapXVal">0</span> px</div>
      </div>
      <input id="mapX" type="range" min="-2000" max="2000" step="1" value="0" />

      <div class="grid">
        <label for="mapY">Map offset Y (px)</label><div class="value"><span id="mapYVal">0</span> px</div>
      </div>
      <input id="mapY" type="range" min="-2000" max="2000" step="1" value="0" />

      <div class="grid">
        <label for="mapScale">Map scale (×)</label><div class="value">×<span id="mapScaleVal">1.00</span></div>
      </div>
      <!-- scale 5% .. 800% -->
      <input id="mapScale" type="range" min="5" max="800" step="1" value="100" />
      <div class="kicker">Zoom range: 0.05× to 8.00×</div>

      <svg viewBox="0 0 420 420" aria-label="Compass with map background" role="img">
        <defs>
          <clipPath id="compassClip">
            <circle cx="210" cy="210" r="170" />
          </clipPath>
        </defs>

        <!-- Subtle background (outside the clipped map) -->
        <rect class="bg" x="0" y="0" width="420" height="420" rx="12" />

        <!-- Map group: we apply translate/scale here and keep the image at its native size -->
        <g id="mapGroup" clip-path="url(#compassClip)">
          <image id="mapImage" href="boston-map.svg"
                 x="0" y="0" width="420" height="420"
                 preserveAspectRatio="xMidYMid slice" opacity="0.95" />
        </g>

        <!-- Compass ring -->
        <circle class="ring" cx="210" cy="210" r="170" />

        <!-- Cardinal ticks -->
        <line class="tick" x1="210" y1="40"  x2="210" y2="60" />
        <line class="tick" x1="380" y1="210" x2="360" y2="210" />
        <line class="tick" x1="210" y1="380" x2="210" y2="360" />
        <line class="tick" x1="40"  y1="210" x2="60"  y2="210" />

        <!-- Labels -->
        <text class="label" x="210" y="28">0° N</text>
        <text class="label" x="392" y="210">90° E</text>
        <text class="label" x="210" y="392">180° S</text>
        <text class="label" x="28"  y="210">270° W</text>

        <!-- Shaded sectors: 58°–122° and 238°–302° (CW from North) -->
        <path id="sector1" class="shade1" d="" />
        <path id="sector2" class="shade2" d="" />

        <!-- Arrow -->
        <g id="arrow" transform="rotate(0 210 210)">
          <line class="arrow-line" x1="210" y1="210" x2="210" y2="70" />
          <polygon class="arrow-head" points="210,54 196,82 224,82" />
        </g>
      </svg>

      <p class="note">
        For huge source maps, use the larger pan/zoom ranges above to focus down to your area of interest.
        If your map isn’t north-up, you can prepend a fixed rotation to <code>#mapGroup</code> (e.g., <code>rotate(12 210 210)</code>).
      </p>
    </div>
  </div>

  <script>
    const CX = 210, CY = 210, R = 170;

    const headingInput = document.getElementById('heading');
    const headingValue = document.getElementById('headingValue');
    const arrow = document.getElementById('arrow');

    const mapGroup = document.getElementById('mapGroup');
    const mapImage = document.getElementById('mapImage');
    const mapX = document.getElementById('mapX');
    const mapY = document.getElementById('mapY');
    const mapScale = document.getElementById('mapScale');
    const mapXVal = document.getElementById('mapXVal');
    const mapYVal = document.getElementById('mapYVal');
    const mapScaleVal = document.getElementById('mapScaleVal');

    mapImage.setAttribute('href', 'boston-affiche-tube.png');

    function polarToCartesian(cx, cy, r, degCWFromNorth) {
      const rad = (degCWFromNorth - 90) * Math.PI / 180;
      return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };
    }
    function wedgePath(cx, cy, r, startDeg, endDeg) {
      let s = ((startDeg % 360) + 360) % 360;
      let e = ((endDeg % 360) + 360) % 360;
      if (e < s) e += 360;
      const largeArc = (e - s) > 180 ? 1 : 0;
      const p0 = polarToCartesian(cx, cy, r, s);
      const p1 = polarToCartesian(cx, cy, r, e);
      return `M ${cx} ${cy} L ${p0.x.toFixed(2)} ${p0.y.toFixed(2)} A ${r} ${r} 0 ${largeArc} 1 ${p1.x.toFixed(2)} ${p1.y.toFixed(2)} Z`;
    }
    document.getElementById('sector1').setAttribute('d', wedgePath(CX, CY, R, 58, 122));
    document.getElementById('sector2').setAttribute('d', wedgePath(CX, CY, R, 238, 302));

    function updateHeading() {
      const deg = Number(headingInput.value);
      headingValue.textContent = deg.toString();
      arrow.setAttribute('transform', `rotate(${deg} ${CX} ${CY})`);
    }
    headingInput.addEventListener('input', updateHeading);
    updateHeading();

    function updateMapTransform() {
      const tx = Number(mapX.value);
      const ty = Number(mapY.value);
      const s = Number(mapScale.value) / 100; // slider 5..800 -> scale 0.05..8
      mapXVal.textContent = tx.toString();
      mapYVal.textContent = ty.toString();
      mapScaleVal.textContent = s.toFixed(2);
      const t = `translate(${CX} ${CY}) scale(${s}) translate(${-CX} ${-CY}) translate(${tx} ${ty})`;
      mapGroup.setAttribute('transform', t);
    }
    mapX.addEventListener('input', updateMapTransform);
    mapY.addEventListener('input', updateMapTransform);
    mapScale.addEventListener('input', updateMapTransform);
    updateMapTransform();
  </script>
</body>
</html>